{% load static %}
{% load jinja_tags %}

<div class="row align-items-center">
    <div class="col-sm-2">&nbsp;</div>
    <div class="col-sm-8">
        <!--div contenedor-->
        <br>
        <!--alerts-->
        {% include 'partials/_alerts.html' %}

        <form name="search" method="post" action="">
            {% csrf_token %}
            <table class="table3 w-100">
                <tr>
                    <th class="w-100 center" colspan="4">
                        Opciones de Busqueda
                    </th>
                </tr>

                <tr class="back2">
                    <td class="right w-20">
                        Fecha Inicio&nbsp;:&nbsp;
                    </td>
                    <td class="left w-30">
                        <input name="search_fecha_ini" id="search_fecha_ini" value="{{ session.search_fecha_ini }}" type="text" class="form-control input w-90 left" readonly="readonly">
                        <script type="text/javascript">
                            var foopicker = new FooPicker({
                                id: 'search_fecha_ini',
                                dateFormat: 'dd-MMM-yyyy'
                            });
                        </script>
                    </td>
                    <td class="right w-20">
                        Fecha Fin&nbsp;:&nbsp;
                    </td>
                    <td class="left w-30">
                        <input name="search_fecha_fin" id="search_fecha_fin" value="{{ session.search_fecha_fin }}" type="text" class="form-control input w-90 left" readonly="readonly">
                        <script type="text/javascript">
                            var foopicker = new FooPicker({
                                id: 'search_fecha_fin',
                                dateFormat: 'dd-MMM-yyyy'
                            });
                        </script>
                    </td>
                </tr>

                <tr class="back1">
                    <td class="right w-20">
                        Apellidos&nbsp;:&nbsp;
                    </td>
                    <td class="left w-30">
                        <input type="text" name="search_apellidos" class="form-control input w-80" value="{{ session.search_apellidos }}" autocomplete="off">
                    </td>
                    <td class="right w-20">
                        Nombres&nbsp;:&nbsp;
                    </td>
                    <td class="left w-30">
                        <input type="text" name="search_nombres" class="form-control input w-80" value="{{ session.search_nombres }}" autocomplete="off">
                    </td>
                </tr>

                <tr class="back2">
                    <td class="right w-20">
                        Venta&nbsp;:&nbsp;
                    </td>
                    <td class="left w-30">
                        <input type="text" name="search_numero_contrato" class="form-control input w-80" value="{{ session.search_numero_contrato }}" autocomplete="off" onkeyup="validarNumero(this);">
                    </td>
                    <td class="right w-20">
                        CI/NIT&nbsp;:&nbsp;
                    </td>
                    <td class="left w-30">
                        <input type="text" name="search_ci_nit" class="form-control input w-80" value="{{ session.search_ci_nit }}" autocomplete="off" onkeyup="validarNumero(this);">
                    </td>
                </tr>

                <tr class="back1">
                    <td colspan="4" class="center w-100">
                        <button class="btn btn-primary btn-sm" name="search_button" onclick="sendSearchVenta();">
                            <i class="nav-icon fas fa-search"></i>&nbsp;&nbsp;Buscar
                        </button>
                        <input type="hidden" name="search_button_x" value="acc">
                        <input type="hidden" name="module_x" value="{{module_x}}">
                    </td>
                </tr>
            </table>
        </form>
        <br>
        <!--paginacion-->
        {% include 'partials/pagination.html' %}

        {%if permisos.adicionar == 1 %}
        <table class="tabla w-100">
            <tr>
                <td class="left w-100">
                    <button class="btn btn-primary btn-sm" name="add_x" onclick="sendOperation(operation='add');">
                        <i class="nav-icon fas fa-plus"></i>&nbsp;&nbsp;Nueva Preventa
                    </button>
                </td>
            </tr>
        </table>
        <br>
        {% endif %}
        <table class="table3 w-100">
            <tr>
                <th class="w-30 pointer left" {% with cabecera=columnas.0 %} {% include 'partials/cabecera_columna.html' %} {% endwith %}>
                    {% with cabecera=columnas.0 %}
                    Evento{% include 'partials/titulo_columna.html' %}
                    {% endwith %}
                </th>
                <th class="w-20 pointer left" {% with cabecera=columnas.1 %} {% include 'partials/cabecera_columna.html' %} {% endwith %}>
                    {% with cabecera=columnas.1 %}
                    Apellidos{% include 'partials/titulo_columna.html' %}
                    {% endwith %}
                </th>
                <th colspan="8" class="w-50 pointer left" {% with cabecera=columnas.2 %} {% include 'partials/cabecera_columna.html' %} {% endwith %}>
                    {% with cabecera=columnas.2 %}
                    Nombres{% include 'partials/titulo_columna.html' %}
                    {% endwith %}
                </th>
            </tr>

            {% for venta in ventas %}
            <tr class="back{{forloop.counter|back_class_color:venta.status_id.status_id}}">
                <td class="left w-30">
                    {{venta.fecha_evento|fecha_mostrar:'dd-MMM-yyyy'}}<br>
                    ({{venta.numero_contrato}})
                </td>
                <td class="left w-20">
                    {{venta.apellidos}}
                </td>
                <td class="left w-15">
                    {{venta.nombres}}
                </td>

                <td class="center w-5">
                    {% if permisos.modificar == 1 and venta.status_id.status_id|venta_to_gastos:'add_gasto' == 1 %}
                    {% with url_id=venta.venta_id boton='fas fa-money-check-alt' operation='gastos' titulo='Gastos' descripcion='Gastos sobre la venta' %}
                    {% include 'partials/btn.html' %}
                    {% endwith %}
                    {% endif %}
                </td>
                
                <td class="center w-5">
                    {% if permisos.modificar == 1 and venta.status_id.status_id|venta_to_gastos:'add_cobro' == 1 %}
                    {% with url_id=venta.venta_id boton='fas fa-dollar-sign' operation='cobros' titulo='Cobros' descripcion='Cobros sobre la venta' %}
                    {% include 'partials/btn.html' %}
                    {% endwith %}
                    {% endif %}
                </td>
                
                <td class="center w-5">
                    {% if permisos.modificar == 1 and venta.status_id.status_id == estado_venta %}
                    {% with url_id=venta.venta_id boton='far fa-plus-square' operation='aumento_pedido' titulo='Aumento' descripcion='Aumento al pedido' %}
                    {% include 'partials/btn.html' %}
                    {% endwith %}
                    {% endif %}
                </td>
                
                <td class="center w-5">
                    {% if permisos.modificar == 1 and venta.status_id.status_id == estado_preventa %}
                    {% with url_id=venta.venta_id boton='fas fa-check-double' operation='pasar_venta' titulo='Venta' descripcion='Confirmar venta' %}
                    {% include 'partials/btn.html' %}
                    {% endwith %}
                    {% endif %}
                    
                    {% if permisos.modificar == 1 and venta.status_id.status_id == estado_venta %}
                    {% with url_id=venta.venta_id boton='fas fa-arrow-alt-circle-right' operation='pasar_salida' titulo='Salida' descripcion='Salida de Almacen' %}
                    {% include 'partials/btn.html' %}
                    {% endwith %}
                    {% endif %}
                    
                    {% if permisos.modificar == 1 and venta.status_id.status_id == estado_salida %}
                    {% with url_id=venta.venta_id boton='fas fa-arrow-alt-circle-left' operation='pasar_vuelta' titulo='Vuelta' descripcion='Vuelta a Almacen' %}
                    {% include 'partials/btn.html' %}
                    {% endwith %}
                    {% endif %}
                    
                    {% if permisos.modificar == 1 and venta.status_id.status_id == estado_vuelta %}
                    {% with url_id=venta.venta_id boton='fas fa-door-closed' operation='pasar_finalizado' titulo='Finalizar' descripcion='Finalizar Venta' %}
                    {% include 'partials/btn.html' %}
                    {% endwith %}
                    {% endif %}
                </td>
                
                <td class="center w-5">
                    {% if permisos.imprimir == 1 %}
                    {% with url_main=url_main url_id=venta.venta_id target='_blank' %}
                    {% include 'partials/btn_imprimir.html' %}
                    {% endwith %}
                    {% else %} &nbsp;
                    {% endif %}
                </td>
                
                <td class="center w-5">
                    {%if permisos.modificar == 1 and venta.status_id.status_id == estado_preventa %}
                    {% with url_main=url_main operation='modify' url_id=venta.venta_id target='' %}
                    {% include 'partials/btn_modificar.html' %}
                    {% endwith %}
                    {% endif %}
                </td>

                <td class="center w-5">
                    {% if permisos.anular == 1 and venta.status_id.status_id != estado_anulado %}
                        {% if venta.status_id.status_id == estado_preventa %}
                            {% with url_id=venta.venta_id boton='fas fa-ban' operation='anular' titulo='Anular' descripcion='Anular esta operacion' %}
                            {% include 'partials/btn.html' %}
                            {% endwith %}
                        {% endif %}
                        
                        {% if venta.status_id.status_id == estado_venta %}
                            {% with url_id=venta.venta_id boton='fas fa-ban' operation='pasar_venta_anular' titulo='Anular' descripcion='Anular esta operacion' %}
                            {% include 'partials/btn.html' %}
                            {% endwith %}
                        {% endif %}
                        
                        {% if venta.status_id.status_id == estado_salida %}
                            {% with url_id=venta.venta_id boton='fas fa-ban' operation='pasar_salida_anular' titulo='Anular' descripcion='Anular esta operacion' %}
                            {% include 'partials/btn.html' %}
                            {% endwith %}
                        {% endif %}
                        
                        {% if venta.status_id.status_id == estado_vuelta %}
                            {% with url_id=venta.venta_id boton='fas fa-ban' operation='pasar_vuelta_anular' titulo='Anular' descripcion='Anular esta operacion' %}
                            {% include 'partials/btn.html' %}
                            {% endwith %}
                        {% endif %}
                        
                        {% if venta.status_id.status_id == estado_finalizado %}
                            {% with url_id=venta.venta_id boton='fas fa-ban' operation='pasar_finalizado_anular' titulo='Anular' descripcion='Anular esta operacion' %}
                            {% include 'partials/btn.html' %}
                            {% endwith %}
                        {% endif %}
                        
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </table>
        <br>
        {% if permisos.adicionar == 1 %}
        <table class="tabla w-100">
            <tr>
                <td class="left w-100">
                    <button class="btn btn-primary btn-sm" name="add_x2" onclick="sendOperation(operation='add');">
                        <i class="nav-icon fas fa-plus"></i>&nbsp;&nbsp;Nueva Preventa
                    </button>
                </td>
            </tr>
        </table>
        <br>
        {% endif %}
    </div>
    <!--fin div contenedor-->
    <div class="col-sm-2">&nbsp;</div>
</div>

<BR><BR>
<form name="form_order" method="post" action="">
    {% csrf_token %}
    <input type="hidden" name="{{session.variable_order}}" value="{{session|get_item:session.variable_order}}">
    <input type="hidden" name="{{session.variable_order_type}}" value="{{session|get_item:session.variable_order_type}}">
</form>

<form name="form_print" method="post" action="{{url_main}}" target="_blank">
    {% csrf_token %}
    <input type="hidden" name="module_x" value="{{module_x}}">
    <input type="hidden" name="operation_x" value="">
    <input type="hidden" name="id" value="">
</form>

<form name="form_operation" method="post" action="{{url_main}}">
    {% csrf_token %}
    <input type="hidden" name="module_x" value="{{module_x}}">
    <input type="hidden" name="module_x2" value="{{module_x2}}">
    <input type="hidden" name="module_x3" value="{{module_x3}}">
    
    <input type="hidden" name="operation_x" value="{{operation_x}}">
    <input type="hidden" name="operation_x2" value="{{operation_x2}}">
    <input type="hidden" name="operation_x3" value="{{operation_x3}}">
    
    <input type="hidden" name="id" value="{{id}}">
    <input type="hidden" name="id2" value="{{id2}}">
    <input type="hidden" name="id3" value="{{id3}}">
</form>
</div>
